<!DOCTYPE html>
<html lang="en" class="h-full bg-[#020617]">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>SellerBrain AI – Your Amazon Profit Co-Pilot</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { font-family: 'Inter', system-ui, sans-serif; }
  </style>
</head>
<body class="min-h-screen text-slate-100 bg-[#020617] flex items-center justify-center">

  <div id="app" class="text-center max-w-4xl mx-auto p-8">
    <h1 class="text-5xl md:text-7xl font-black mb-8">
      Your Amazon business<br>
      <span class="text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-cyan-400">deserves a brain.</span>
    </h1>
    <div id="result" class="mt-12 text-6xl font-black text-green-400">Fetching your real data…</div>
  </div>

<script>
// ==================== ONLY CHANGE THIS LINE ====================
const PROXY_URL = "https://amazon-proxy.vercel.app/"; // ← YOUR EXACT VERCEL PROXY URL HERE
// ==============================================================

const GROQ_API_KEY = "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";
const REFRESH_TOKEN = "Atzr|IwEBIK05-L5yJvoXlc-1YN0Y1ZEvw2gmsWRsld9RrEhi4j091tfQ2xqyMgoieutponEcjCYTzjgvwdjNg23xoWYBQZxUTF0f9qXwtTXNBEaMtyl9zKYROCUjGklaA28BU1TSnTV7-fYPGOYe6ZZiVJhDXDCDqJe25diGPN8RlJq_Jfyoe1IqU3I6Yrz3dZSyJXJduWvB9GYxxDY_NqMcbIqQGjudw4CiiNitdpTvh3VuX3f6i7SBr8Qx73pwFAtP6OhVw-XpaJORsq2mc5L_35qProPKDg9qKt1wV4d0kcaJB-KKzXZ88N7k6221dWCSZLcsaf4";

async function run() {
  try {
    // Get fresh access token
    const tokenResp = await fetch(`${PROXY_URL}/api/token`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ refresh_token: REFRESH_TOKEN })
    });
    const { access_token } = await tokenResp.json();

    // Pull orders + inventory
    const [orders, inventory] = await Promise.all([
      fetch(`${PROXY_URL}/api/orders`, { headers: { token: access_token } }).then(r => r.json()),
      fetch(`${PROXY_URL}/api/inventory`, { headers: { token: access_token } }).then(r => r.json())
    ]);

    // Send to Groq AI
    const groq = await fetch("https://api.groq.com/openai/v1/chat/completions", {
      method: "POST",
      headers: {
        "Authorization": `Bearer ${GROQ_API_KEY}`,
        "Content-Type": "application/json"
      },
      body: JSON.stringify({
        model: "llama-3.1-70b-versatile",
        temperature: 0.3,
        messages: [
          { role: "system", content: "You are SellerBrain AI. Return ONLY valid JSON with keys: profit30d (number), pricingPower (0-100), reviewTrust (0-100), plan (array of objects with action:string and impact:string)" },
          { role: "user", content: JSON.stringify({orders, inventory}) }
        ]
      })
    }).then(r => r.json());

    const result = JSON.parse(groq.choices[0].message.content || "{}");

    // Show results
    document.getElementById('app').innerHTML = `
      <h1 class="text-6xl font-black mb-12">SellerBrain AI – Your Real Results</h1>
      <div class="text-7xl font-black text-green-400 mb-10">$${result.profit30d?.toLocaleString() || "0"}</div>
      <div class="text-4xl mb-10">
        Pricing Power: <span class="text-blue-400">${result.pricingPower ?? "—"}/100</span> • 
        Review Trust: <span class="text-purple-400">${result.reviewTrust ?? "—"}/100</span>
      </div>
      <div class="text-left max-w-3xl mx-auto text-2xl space-y-6">
        <h2 class="text-4xl font-bold text-center mb-6">Your 72-Hour Profit Plan</h2>
        ${(result.plan || []).map(p => `
          <div class="bg-slate-800/70 p-6 rounded-2xl">
            → ${p.action}
            <span class="text-green-400 font-bold ml-4">${p.impact}</span>
          </div>
        `).join('') || "<p class='text-center text-slate-400'>No urgent actions – your account is healthy!</p>"}
      </div>
    `;

  } catch (e) {
    document.getElementById('result').textContent = "Error: " + e.message;
    document.getElementById('result').className = "text-red-400";
  }
}

run();
</script>
</body>
</html>
