<!DOCTYPE html>
<html lang="en" class="h-full bg-[#020617]">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>SellerBrain AI – Your Amazon Profit Co-Pilot</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>body { font-family: 'Inter', system-ui, sans-serif; }</style>
</head>
<body class="min-h-screen text-slate-100 bg-[#020617]">

  <div class="min-h-screen flex items-center justify-center px-6">
    <div class="text-center max-w-4xl mx-auto">
      <h1 class="text-5xl md:text-7xl font-black mb-6">
        Your Amazon business<br><span class="text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-cyan-400">deserves a brain.</span>
      </h1>
      <p class="text-3xl font-bold text-green-400 mt-20" id="status">Fetching your real data…</p>
    </div>
  </div>

<script>
// YOUR KEYS — NEVER CHANGE AGAIN
const REFRESH_TOKEN = "Atzr|IwEBIK05-L5yJvoXlc-1YN0Y1ZEvw2gmsWRsld9RrEhi4j091tfQ2xqyMgoieutponEcjCYTzjgvwdjNg23xoWYBQZxUTF0f9qXwtTXNBEaMtyl9zKYROCUjGklaA28BU1TSnTV7-fYPGOYe6ZZiVJhDXDCDqJe25diGPN8RlJq_Jfyoe1IqU3I6Yrz3dZSyJXJduWvB9GYxxDY_NqMcbIqQGjudw4CiiNitdpTvh3VuX3f6i7SBr8Qx73pwFAtP6OhVw-XpaJORsq2mc5L_35qProPKDg9qKt1wV4d0kcaJB-KKzXZ88N7k6221dWCSZLcsaf4";
const GROQ_KEY = "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";

// Tiny free proxy that bypasses CORS (thank you Cloudflare workers community)
const PROXY = "https://sp-api-proxy.deno.dev";

async function run() {
  // 1. Get fresh access token
  const tokenResp = await fetch(`${PROXY}/token`, {
    method: "POST",
    body: JSON.stringify({ refresh_token: REFRESH_TOKEN })
  });
  const { access_token } = await tokenResp.json();

  // 2. Pull orders + inventory
  const [orders, inventory] = await Promise.all([
    fetch(`${PROXY}/orders`, { headers: { token: access_token } }).then(r => r.json()),
    fetch(`${PROXY}/inventory`, { headers: { token: access_token } }).then(r => r.json())
  ]);

  // 3. Send to Groq
  const groq = await fetch("https://api.groq.com/openai/v1/chat/completions", {
    method: "POST",
    headers: { "Authorization": `Bearer ${GROQ_KEY}`, "Content-Type": "application/json" },
    body: JSON.stringify({
      model: "llama-3.1-70b-versatile",
      messages: [
        { role: "system", content: "Return ONLY valid JSON: {profit30d:number, pricingPower:0-100, reviewTrust:0-100, plan:[{action:string, impact:string}]}" },
        { role: "user", content: JSON.stringify({orders, inventory}) }
      ]
    })
  }).then(r => r.json());

  const r = JSON.parse(groq.choices[0].message.content || "{}");

  // 4. Show results
  document.body.innerHTML = `
    <div class="min-h-screen p-10 text-center">
      <h1 class="text-6xl font-black mb-10">SellerBrain AI – Your Real Results</h1>
      <div class="text-6xl font-black text-green-400 mb-8">30-day Net Profit: ${new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD' }).format(r.profit30d || 0)}</div>
      <div class="text-4xl mb-8">Pricing Power: <span class="text-blue-400">${r.pricingPower ?? "—"}/100</span> | Review Trust: <span class="text-purple-400">${r.reviewTrust ?? "—"}/100</span></div>
      <div class="max-w-4xl mx-auto text-left">
        <h2 class="text-4xl font-bold mb-6">Your 72-Hour Profit Plan</h2>
        ${ (r.plan || []).map(p => `<div class="bg-slate-800/60 p-6 rounded-xl mb-4 text-xl">• ${p.action} <span class="text-green-400 font-bold">${p.impact}</span></div>`).join('') || "<p>No urgent actions – great job!</p>" }
      </div>
    </div>
  `;
}

run().catch(e => document.getElementById('status').textContent = "Error: " + e.message);
</script>
</body>
</html>
